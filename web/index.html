<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Everloop | Content Discovery Platform</title>
    <link rel="stylesheet" href="styles/style.css" />    <!-- External JS with onTelegramAuth must load before widget -->
    <script src="auth.js"></script>
</head>
<body>
<h1>Everloop</h1>
<p>Continuous content discovery & trend analysis. Login with Telegram to get started.</p>
<!-- Telegram Login button placeholder -->
<div id="tg-login"></div>
<script async src="https://telegram.org/js/telegram-widget.js?22"
        data-telegram-login="everloopad_bot"
        data-size="large"
        data-auth-url="/auth/telegram"
        data-request-access="write"
        data-userpic="false"
        data-lang="en"
        data-selector="tg-login">
</script>
<div id="status"></div>
<button id="test-post">Test POST manually</button>

<script>
    document.getElementById('test-post').addEventListener('click', async () => {
        const testData = {
            id: 123456,
            username: 'testuser',
            first_name: 'Test',
            last_name: 'User',
            hash: 'testhash',
            auth_date: Math.floor(Date.now() / 1000)
        };
        try {
            const res = await fetch('/auth/telegram', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(testData)
            });
            const data = await res.json();
            console.log('Manual POST response:', data);
            alert(JSON.stringify(data));
        } catch (err) {
            console.error('POST error:', err);
            alert('POST failed');
        }
    });
</script>
</body>
</html>